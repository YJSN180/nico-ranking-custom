# タグ別ランキングの動的読み込み実装

## 概要
タグ別ランキングでは、初回100件のみ取得し、「さらに読み込む」ボタンで100件ずつ追加読み込みする方式を実装しました。

## 実装内容

### 1. API側の変更
- `page`パラメータを追加
- タグ別ランキングの場合は100件ずつ取得
- ページごとに異なるキャッシュキーを使用
- 表示時にNGフィルタリングを適用

### 2. クライアント側の変更

#### sessionStorageを使った状態保存
```typescript
const storageKey = `ranking-state-${genre}-${period}-${tag || 'none'}`
```

保存されるデータ：
- `items`: 読み込み済みのランキングデータ
- `displayCount`: 現在表示中の件数
- `currentPage`: 現在のページ番号
- `hasMore`: さらにデータがあるか
- `scrollPosition`: スクロール位置

#### 追加読み込み機能
```typescript
const loadMoreItems = async () => {
  // 次のページをAPIから取得
  // ランク番号を調整して既存データに追加
}
```

### 3. ユーザー体験

1. **初回表示**: 100件表示（高速）
2. **「もっと見る」**: メモリ内のデータを表示（即座）
3. **「さらに読み込む」**: APIから次の100件を取得
4. **ブラウザバック**: 状態が復元され、前回の位置に戻る

## パフォーマンス最適化

### NGフィルタリングの最適化
- 1分間のメモリキャッシュ
- Set型によるO(1)検索

### リソース使用量
- **通常ランキング**: 300件×数十ジャンル = KVストレージ大
- **タグ別ランキング**: 必要な分だけ = KVストレージ節約

## テスト結果
- ページ1: 100件 → NGフィルタリング後95件
- ページ2: 100件 → NGフィルタリング後95件
- ページ3: 19件（残り全部）
- 重複なし、ランク連続性OK